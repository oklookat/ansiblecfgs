*filter

# Default policies
:INPUT DROP [0:0]
:FORWARD DROP [0:0]
:OUTPUT ACCEPT [0:0]

# Allow loopback interface
-A INPUT -i lo -j ACCEPT

# Allow established and related connections
-A INPUT -m conntrack --ctstate ESTABLISHED,RELATED -j ACCEPT

# Allow WireGuard UDP port
-A INPUT -p udp --dport {{ wg_port }} -j ACCEPT

# Allow SSH TCP port
-A INPUT -p tcp --dport {{ new_ssh_port }} -j ACCEPT

# Allow ICMPv6 (ping, etc)
-A INPUT -p icmpv6 -j ACCEPT

# Allow all incoming traffic from WireGuard interface
-A INPUT -i wg0 -j ACCEPT

# Allow forwarding between WireGuard peers
-A FORWARD -i wg0 -o wg0 -j ACCEPT

COMMIT